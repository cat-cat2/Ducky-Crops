<!doctype html>
<html>
<head>
  <meta charset="utf-8"><title>Files - Duck Corp</title>
  <link rel="stylesheet" href="style.css">
  <script src="/client.js"></script>
</head>
<body class="duck-theme">
  <div class="container">
    <header><div class="brand">üê• Duck Corporations</div></header>
    <div id="mainNav" style="margin-bottom:10px"></div>

    <div class="card">
      <h2>Files</h2>
      <div id="files"></div>
      <div id="viewer" style="margin-top:12px;"></div>
    </div>

    <footer>Duck Corporations</footer>
  </div>

<script>
  renderNav();
  requireLoginRedirect();

  async function loadFiles(){
    const r = await fetch("/api/files");
    const list = await r.json();
    const el = document.getElementById("files");
    el.innerHTML = "";
    list.forEach((f, idx) => {
      const item = document.createElement("div");
      if (f.embed) {
        item.innerHTML = `<strong>${escapeHtml(f.name)}</strong> ‚Äî <button data-idx="${idx}" class="file-link small">Open Embedded</button>`;
      } else {
        item.innerHTML = `<a href="${f.url}" target="_blank" rel="noopener">${escapeHtml(f.name)}</a>`;
      }
      el.appendChild(item);
    });
    document.querySelectorAll(".file-link").forEach(btn => {
      btn.onclick = (e) => {
        const idx = +e.target.dataset.idx;
        const file = list[idx];
        document.getElementById("viewer").innerHTML = `
          <div style="margin-bottom:8px">
            <a href="${file.url}" target="_blank" rel="noopener">Open in new tab</a>
          </div>
          <iframe src="${file.url}" style="width:100%;height:700px;border:1px solid #ddd;border-radius:8px"></iframe>
        `;
      };
    });
  }

  loadFiles();
</script>
</body>
</html>
